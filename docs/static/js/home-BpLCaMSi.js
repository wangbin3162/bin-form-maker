import{n as Ve,a8 as P,ad as I,ae as Y,R as r,o as s,j as V,K as t,w as e,a as k,H as M,b as m,t as W,i as T,e as N,T as le,x as Oe,L as u,ah as we,X as re,r as D,J as me,a2 as Q,Q as U,O as ee,g as be,v as ve,f as h,I as je,l as ae,F as A,af as ze,ag as Ue,Z as $e,Y as Ne,al as Be}from"./vendor-n4eBbqf6.js";import{u as Re,c as Ae,n as ne}from"./chunk-bin-ui-design-D7iY_yTs.js";import{u as L,f as ge,c as ye,l as Me,b as Le,i as G,a as xe,g as Ee,d as Ie,D as oe,C as Pe,e as qe,O as he,h as He,j as H,k as Je,m as Ye,n as Ke,t as Qe}from"./index-bC7FjFMD.js";import"./chunk-brace-DiF9biBn.js";function Xe(n){const{addClass:a,removeClass:o,hasClass:c,getStyle:l,getScrollBarWidth:p}=Re.dom;let i=0,d=!1,g="0",y=0,b=null;Ve(n,_=>{if(_){b&&clearTimeout(b),d=!c(document.body,"bin-popup-parent--hidden"),d&&(g=document.body.style.paddingRight,y=parseInt(l(document.body,"paddingRight"),10)),i=p();const f=document.documentElement.clientHeight<document.body.scrollHeight,v=l(document.body,"overflowY");a(document.body,"bin-popup-parent--hidden"),i>0&&(f||v==="scroll")&&d&&(document.body.style.paddingRight=y+i+"px",a(document.body,"with-scrollbar"))}else b=setTimeout(()=>{d&&(document.body.style.paddingRight=g,o(document.body,"bin-popup-parent--hidden"),o(document.body,"with-scrollbar")),d=!0},300)})}const Ze={class:"fm-header"},Ge={class:"title"},et={class:"logo"},tt={class:"over-hidden"},lt={key:0},ot={class:"right"},nt={class:"fm-content"},at=Object.assign({name:"MakerLayout"},{__name:"index",props:I({topTitle:{type:String,default:"FormMaker 表单设计器"},inner:Boolean,appendToBody:{type:Boolean,default:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:I(["close","rollback"],["update:modelValue"]),setup(n,{emit:a}){const o=a,c=Y(n,"modelValue");Xe(c);function l(){Ae.confirm({type:"warning",title:"提示",message:'<p>没有保存的内容会<span style="color:red;">丢失</span>！确认返回吗？</p>',useHTML:!0}).then(()=>{c.value=!1,o("close")}).catch(()=>{})}return(p,i)=>{const d=r("b-icon");return s(),V(Oe,{to:"body",disabled:!n.appendToBody},[t(le,{name:"move-right"},{default:e(()=>[c.value?(s(),k("div",{key:0,class:M(["fm-container maker-layout",{inner:n.inner}])},[m("div",Ze,[m("div",Ge,[m("span",et,[t(d,{name:"insertrowabove",size:"24"})]),m("div",tt,[n.topTitle?(s(),k("span",lt,W(n.topTitle),1)):T("",!0)])]),m("div",ot,[t(d,{name:"close",type:"button",onClick:l})])]),m("div",nt,[N(p.$slots,"default",{},void 0,!0)])],2)):T("",!0)]),_:3})],8,["disabled"])}}}),it=P(at,[["__scopeId","data-v-41d9248e"]]),st={class:"title"},dt=["onClick"],ct={key:0},ut={class:"field-name"},rt={class:"field-name"},mt=Object.assign({name:"CompList"},{__name:"comp-list",props:{title:{type:String,default:""},list:{type:Array,default:()=>[]},isCustom:{type:Boolean,default:!1},isField:{type:Boolean,default:!1}},setup(n){const a=n,{addWidget:o,alreadyInFieldModels:c}=L();function l(i){if(c.value.includes(i.fieldName))return;const d=a.isField?ge(i):ye(i.type,i.name,a.isCustom);o(d)}function p(i){return a.isField?ge(i):ye(i.type,i.name,a.isCustom)}return(i,d)=>{const g=r("b-icon"),y=r("b-collapse-wrap");return s(),V(y,{collapse:"",style:{margin:"0 0 1px"}},{title:e(()=>[m("span",st,W(n.title),1)]),default:e(()=>[t(u(we),re({tag:"ul",list:n.list,"item-key":"type"},{group:{name:"form",pull:"clone",put:!1},sort:!1,ghostClass:"ghost"},{filter:".disabled",clone:p}),{item:e(({element:b})=>[m("li",{class:M(["form-edit-widget-label no-put",{disabled:u(c).includes(b.fieldName)}]),onClick:_=>l(b)},[n.isField?(s(),k("a",{key:1,class:M({required:b.required})},[m("span",rt,W(b.fieldTitle),1)],2)):(s(),k("a",ct,[t(g,{name:b.icon},null,8,["name"]),m("span",ut,W(b.name),1)]))],10,dt)]),_:1},16,["list"])]),_:1})}}}),te=P(mt,[["__scopeId","data-v-576c4456"]]),pt={class:"components-list"},ft={class:"top-fix"},_t={class:"config-content"},bt={key:0},vt={key:1,class:"p8"},gt=Object.assign({name:"CompsList"},{__name:"index",setup(n){const a=D("comps"),o=D(null),c=[{key:"comps",title:"组件",icon:"appstore"},{key:"form",title:"大纲",icon:"cluster"}],{handleSelectWidget:l,treeList:p,ctrlCfgs:i,slotsWedigets:d,realFieldsDtos:g}=L();function y(b,_){var f;if(["col","tag"].includes(_.type))(f=o.value)==null||f.unselectAll();else{const v=i.value[_.model];l(v)}}return(b,_)=>{const f=r("b-tabs"),v=r("b-tree"),$=r("b-scrollbar");return s(),k("div",pt,[m("div",ft,[t(f,{modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=j=>a.value=j),data:c},null,8,["modelValue"])]),m("div",_t,[t($,null,{default:e(()=>[a.value==="comps"?(s(),k("div",bt,[t(te,{title:"布局控件",list:u(Me)},null,8,["list"]),t(te,{title:"表单控件",list:u(Le)},null,8,["list"]),u(d).length>0?(s(),V(te,{key:0,title:"自定义控件",list:u(d),"is-custom":""},null,8,["list"])):T("",!0),u(g).length>0?(s(),V(te,{key:1,title:"属性字段",list:u(g),"is-field":""},null,8,["list"])):T("",!0)])):(s(),k("div",vt,[t(v,{data:u(p),ref_key:"treeRef",ref:o,onSelectChange:y},null,8,["data"])]))]),_:1})])])}}}),yt=P(gt,[["__scopeId","data-v-f2c56e23"]]),ht=["title"],kt={key:1,style:{height:"32px","background-color":"var(--bin-color-bg-disabled)"},flex:"main:center cross:center"},Ct=Object.assign({name:"WidgetFormItem"},{__name:"WidgetFormItem",props:{element:{type:Object,default:()=>({})}},setup(n){const{widgetForm:a,slotsWedigets:o}=L();return(c,l)=>{const p=r("b-icon"),i=r("b-tooltip"),d=r("b-form-item");return s(),V(d,{class:M({"is-required":n.element.config.required})},{label:e(()=>[m("span",{style:{"margin-left":"2px"},class:"over-hidden",title:n.element.label},W(n.element.label),9,ht),n.element.config.tooltip!==""?(s(),V(i,{key:0,content:n.element.config.tooltip,theme:"light"},{default:e(()=>[t(p,{name:"question-circle",style:{"margin-left":"2px"},size:"14"})]),_:1},8,["content"])):T("",!0)]),default:e(()=>[n.element.config.hidden?(s(),k("div",kt," 当前组件属于隐藏状态 ")):(s(),V(me(`BF-${n.element.type}`),{key:0,data:n.element,"model-value":n.element.config.defaultValue,"form-config":u(a).config},Q({_:2},[U(u(o),g=>({name:g.type,fn:e(({node:y})=>[N(c.$slots,g.type,{node:y})])}))]),1032,["data","model-value","form-config"]))]),_:3},8,["class"])}}}),Vt=["onClick"],wt=["onClick"],$t=m("i",{class:"b-iconfont b-icon-drag drag-widget"},null,-1),xt=[$t],St={class:"widget-view-field-name"},Dt=Object.assign({name:"WidgetNest"},{__name:"WidgetNest",props:{widgets:{type:Array,default:()=>[]}},setup(n){const{widgetForm:a,slotsWedigets:o,isComSelected:c,deleteWidget:l,handleSelectWidget:p,handleWidgetAdd:i}=L();return(d,g)=>{const y=r("WidgetNest",!0);return s(),V(u(we),{tag:"div","item-key":"key",group:"form","ghost-class":"ghost",handle:".drag-widget",list:n.widgets,animation:200,onAdd:g[0]||(g[0]=b=>u(i)(b,n.widgets))},{item:e(({element:b,index:_})=>[m("div",{class:M(["widget-view",{active:u(c)(b),"widget-col":u(G)(b.type)}]),onClick:ee(f=>u(p)(b),["stop"])},[u(G)(b.type)?(s(),V(me(`BF-${b.type}`),{key:0,data:b,"form-config":u(a).config},{default:e(({data:f})=>[t(y,{widgets:f.list,class:"widget-col-list"},null,8,["widgets"])]),_:2},1032,["data","form-config"])):(s(),V(Ct,{key:1,element:b},Q({_:2},[U(u(o),f=>({name:f.type,fn:e(({node:v})=>[N(d.$slots,f.type,{node:v})])}))]),1032,["element"])),be(m("div",{class:M(["widget-view-action",{"widget-col-action":u(G)(b.type)}])},[m("i",{class:"b-iconfont b-icon-delete",title:"删除",onClick:ee(f=>u(l)(n.widgets,_),["stop"])},null,8,wt)],2),[[ve,u(c)(b)]]),be(m("div",{class:M(["widget-view-drag",{"widget-col-drag":u(G)(b.type)}])},xt,2),[[ve,u(c)(b)]]),m("div",St,[m("span",null,W(b.model),1)])],10,Vt)]),_:3},8,["list"])}}}),Ft={class:"widget-form-container"},Wt=Object.assign({name:"WidgetForm"},{__name:"WidgetForm",setup(n){const{widgetForm:a,slotsWedigets:o}=L();return(c,l)=>{const p=r("b-form");return s(),k("div",Ft,[t(p,{ref:"formRef","label-position":u(a).config.labelPosition,"label-suffix":u(a).config.labelSuffix,"label-width":`${u(a).config.labelWidth}px`,size:u(a).config.size},{default:e(()=>[t(Dt,{class:"widget-form-list",widgets:u(a).list},Q({_:2},[U(u(o),i=>({name:i.type,fn:e(({node:d})=>[N(c.$slots,i.type,{node:d})])}))]),1032,["widgets"])]),_:3},8,["label-position","label-suffix","label-width","size"])])}}}),Tt={name:"ActionButton",props:{buttonProps:{type:Object},popperWidth:{type:Number,default:260},message:{type:String,default:"确定删除本条数据吗？"},disabled:Boolean,confirm:Boolean,tooltip:String,icon:String,type:String,color:String,isIcon:Boolean,loading:Boolean,iconStyle:{type:Object,default:()=>({fontSize:"18px"})}},data(){return{visible:!1}},emits:["cancel","click"],computed:{btnProps(){return{type:this.type,textColor:this.color,disabled:this.disabled,loading:this.loading,...this.buttonProps}}},methods:{handleCancel(){this.visible=!1,this.$emit("cancel")},handleOk(){this.visible=!1,this.$emit("click")},handleClick(){this.confirm||this.$emit("click")}}},Ot={style:{"line-height":"22px","margin-bottom":"8px"}},jt={style:{"text-align":"right",margin:"0"}};function zt(n,a,o,c,l,p){const i=r("b-button"),d=r("b-icon"),g=r("b-popover");return s(),V(g,{visible:l.visible,"onUpdate:visible":a[0]||(a[0]=y=>l.visible=y),width:o.popperWidth,disabled:!o.confirm},{content:e(()=>[m("p",Ot,[t(d,{name:"question-circle",size:"16",color:"#fa8c16"}),h(" "+W(o.message),1)]),m("div",jt,[t(i,{size:"mini",type:"text",onClick:p.handleCancel},{default:e(()=>[h("取消")]),_:1},8,["onClick"]),t(i,{type:"primary",size:"mini",onClick:p.handleOk},{default:e(()=>[h("确认")]),_:1},8,["onClick"])])]),default:e(()=>[t(i,re(p.btnProps,{onClick:p.handleClick,title:o.tooltip}),{default:e(()=>[o.icon?(s(),k("i",{key:0,class:M(`b-iconfont b-icon-${o.icon}`),style:je(o.iconStyle)},null,6)):T("",!0),N(n.$slots,"default")]),_:3},16,["onClick","title"])]),_:3},8,["visible","width","disabled"])}const J=P(Tt,[["render",zt]]),pe=Object.assign({name:"DebugModal"},{__name:"index",props:{data:{type:[Object,Array]},title:{type:String,default:"查看json"},width:{type:String,default:"600px"},height:{type:String,default:"400px"}},setup(n,{expose:a}){const o=n,c=D(""),l=D(!1),p=D(!1);function i(){p.value=!1,c.value=JSON.stringify(o.data,null,2),l.value=!0}function d(){p.value=!0}function g(y){p.value=!1,c.value=JSON.stringify(y,null,2),l.value=!0}return a({show:g}),(y,b)=>{const _=r("b-icon"),f=r("b-button"),v=r("b-ace-editor"),$=r("b-skeleton"),j=r("b-modal");return s(),k("div",{onClick:i},[N(y.$slots,"default",{},()=>[t(f,{onClick:i,type:"text","text-color":"danger"},{default:e(()=>[t(_,{name:"bug",size:"18"})]),_:1})]),t(j,{title:n.title,"append-to-body":"",modelValue:l.value,"onUpdate:modelValue":b[0]||(b[0]=O=>l.value=O),width:n.width,onOpened:d,"screen-center":""},{default:e(()=>[t($,{loading:!p.value,animation:"",rows:10},{default:e(()=>[t(v,{"model-value":c.value,readonly:"",height:n.height},null,8,["model-value","height"])]),_:1},8,["loading"])]),_:1},8,["title","modelValue","width"])])}}}),Ut={class:"custom-input"},Nt={flex:"cross:center",class:"mb-5"},Se=Object.assign({name:"BFCustomNode"},{__name:"CustomNode",props:I({data:{type:Object,required:!0},formConfig:{type:Object,required:!0}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=n,o=Y(n,"modelValue");return ae(()=>a.data.config),(c,l)=>{const p=r("b-tag"),i=r("b-input");return s(),k("div",Ut,[m("div",Nt,[t(p,null,{default:e(()=>[h("自定义组件")]),_:1}),h(" "+W(o.value),1)]),t(i,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=d=>o.value=d)},null,8,["modelValue"])])}}}),Bt={class:"preview",style:{"min-height":"520px"}},Rt={flex:"main:center cross:center"},At=Object.assign({name:"FormPreview"},{__name:"index",setup(n,{expose:a}){const o=D(!1),c=D("EDIT"),{initSchema:l,formModels:p}=xe(),i=D({}),d=D(null);function g(_,f,v){o.value=!0,l(_,f,v)}async function y(){var f;const _=await((f=d.value)==null?void 0:f.getFormData());_?(ne.success("校验通过!"),console.log(_)):ne.error("校验失败!")}function b(){var _;(_=d.value)==null||_.resetForm()}return a({open:g}),(_,f)=>{const v=r("BFRenderForm"),$=r("b-button"),j=r("b-modal");return s(),V(j,{modelValue:o.value,"onUpdate:modelValue":f[1]||(f[1]=O=>o.value=O),title:"表单预览",width:"1400px","screen-center":""},{footer:e(()=>[m("div",Rt,[t($,{onClick:f[0]||(f[0]=O=>o.value=!1)},{default:e(()=>[h("关 闭")]),_:1}),c.value!=="DETAIL"?(s(),k(A,{key:0},[t($,{onClick:b},{default:e(()=>[h("重 置")]),_:1}),t(pe,{style:{display:"inline-block",margin:"0 8px"},data:{formModels:u(p)},title:"查看数据"},{default:e(()=>[t($,{icon:"edit-square"},{default:e(()=>[h("查看数据")]),_:1})]),_:1},8,["data"]),t($,{type:"primary",onClick:y},{default:e(()=>[h("测试提交")]),_:1})],64)):T("",!0)])]),default:e(()=>[m("div",Bt,[o.value?(s(),V(v,{key:0,"default-model":i.value,ref_key:"renderFormRef",ref:d},{"custom-comp":e(({node:O})=>[t(Se,re(O,{modelValue:u(p)[O.data.model],"onUpdate:modelValue":B=>u(p)[O.data.model]=B}),null,16,["modelValue","onUpdate:modelValue"])]),_:1},8,["default-model"])):T("",!0)])]),_:1},8,["modelValue"])}}}),Mt={class:"center-container"},Lt={class:"top-fix",flex:"main:justify cross:center"},Et={class:"top-fix-left",flex:"cross:center"},It={class:"top-fix-right"},Pt={class:"scroll-content"},qt={key:0,class:"form-empty"},Ht=Object.assign({name:"CenterContainer"},{__name:"index",emits:["onSave"],setup(n,{emit:a}){const o=a,{widgetForm:c,slotsWedigets:l,clearSchema:p,quickLayout:i,realFieldsDtos:d}=L();function g(v,$){const j={pdf:"application/pdf",doc:"application/vnd.ms-word",docx:"application/vnd.ms-word",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint",js:"application/x-javascript",json:"application/json",zip:"application/zip",mp3:"audio/mpeg",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",txt:"text/plain",xml:"image/text/xml"},O=$.split(".").pop().toLocaleLowerCase()||"",B=new Blob([v],{type:j[O]});if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(B,$);else{const F=document.createElement("a");F.href=window.URL.createObjectURL(B),F.setAttribute("download",$),document.body.appendChild(F),F.click(),document.body.removeChild(F),window.URL.revokeObjectURL(F.href)}}const y=()=>{g(JSON.stringify(c.value,null,2),`form_${Ee()}.json`),ne.success({message:"模板文件已保存！",showClose:!0})};function b(){o("onSave")}const _=D(null);function f(){var v;(v=_.value)==null||v.open(c.value,d.value,l.value)}return(v,$)=>{const j=r("b-button"),O=r("b-dropdown-item"),B=r("b-dropdown-menu"),F=r("b-dropdown"),R=r("b-divider"),ie=r("b-empty"),se=r("b-scrollbar");return s(),k("div",Mt,[m("div",Lt,[m("div",Et,[u(d).length?(s(),V(F,{key:0,onCommand:u(i)},{dropdown:e(()=>[t(B,null,{default:e(()=>[t(O,{name:1},{default:e(()=>[h("通栏布局")]),_:1}),t(O,{name:2},{default:e(()=>[h("双列布局")]),_:1}),t(O,{name:4},{default:e(()=>[h("四列布局")]),_:1})]),_:1})]),default:e(()=>[t(j,{icon:"layout",type:"text"},{default:e(()=>[h("快速配置")]),_:1})]),_:1},8,["onCommand"])):T("",!0)]),m("div",It,[t(j,{type:"text",icon:"eye",onClick:f},{default:e(()=>[h("预览")]),_:1}),t(R,{type:"vertical"}),t(pe,{style:{display:"inline-block"},data:u(c),title:"widgetForm配置信息"},{default:e(()=>[t(j,{type:"text",icon:"edit-square"},{default:e(()=>[h("查看JSON")]),_:1})]),_:1},8,["data"]),t(R,{type:"vertical"}),t(j,{type:"text",icon:"export",onClick:y},{default:e(()=>[h("导出JSON")]),_:1}),t(R,{type:"vertical"}),t(j,{type:"text",icon:"save",onClick:b},{default:e(()=>[h("保存")]),_:1}),t(R,{type:"vertical"}),t(J,{type:"text",color:"#f5222d",icon:"delete",message:"确认清空画布吗？",confirm:"",onClick:u(p)},{default:e(()=>[h(" 清空 ")]),_:1},8,["onClick"])])]),m("div",Pt,[t(se,null,{default:e(()=>[u(c).list.length===0?(s(),k("div",qt,[t(ie,null,{default:e(()=>[h("从左侧拖拽或点击来添加字段")]),_:1})])):T("",!0),t(Wt,null,Q({_:2},[U(u(l),q=>({name:q.type,fn:e(({node:X})=>[N(v.$slots,q.type,{node:X},void 0,!0)])}))]),1024)]),_:3})]),t(At,{ref_key:"previewRef",ref:_},Q({_:2},[U(u(l),q=>({name:q.type,fn:e(({node:X})=>[N(v.$slots,q.type,{node:X},void 0,!0)])}))]),1536)])}}}),Jt=P(Ht,[["__scopeId","data-v-389b31fa"]]),Yt={class:"form-config-container"},Kt={key:0,class:"radio-group"},Qt={class:"config-content"},Xt=Object.assign({name:"WidgetConfig"},{__name:"WidgetConfig",props:I({size:{type:String,default:"small"}},{modelValue:{type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=Y(n,"modelValue"),o=D("base"),c=D([]);return Ve(()=>a.value.key,()=>{o.value="base",c.value=Ie(a.value.type)?[{title:"基础",key:"base"},{title:"选项",key:"options"},{title:"验证",key:"validate"}]:[{title:"基础",key:"base"},{title:"验证",key:"validate"}]},{immediate:!0}),(l,p)=>{const i=r("b-radio"),d=r("b-radio-group"),g=r("b-scrollbar");return s(),k("div",Yt,[u(G)(a.value.type)?T("",!0):(s(),k("div",Kt,[t(d,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=y=>o.value=y),size:"default",type:"capsule"},{default:e(()=>[(s(!0),k(A,null,U(c.value,y=>(s(),V(i,{label:y.key,key:y.key},{default:e(()=>[h(W(y.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])),m("div",Qt,[t(g,null,{default:e(()=>[(s(),V(me(`BF-${a.value.type}-config`),{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=y=>a.value=y),tab:o.value},null,8,["modelValue","tab"]))]),_:1})])])}}}),Zt=P(Xt,[["__scopeId","data-v-09325009"]]),K=n=>(ze("data-v-6b901076"),n=n(),Ue(),n),Gt=K(()=>m("div",{class:"title"},"字段列表",-1)),el={key:1},tl=["onDragstart"],ll={class:"field-name"},ol={class:"right-box"},nl={class:"right-top"},al=K(()=>m("div",{class:"title"},"规则条件",-1)),il={class:"p8"},sl={style:{padding:"0 8px"}},dl=K(()=>m("span",null,"可放置此处增加规则条件",-1)),cl=[dl],ul={class:"right-half"},rl=K(()=>m("div",{class:"title"},"满足动作",-1)),ml={class:"p8"},pl={style:{padding:"0 8px"}},fl=K(()=>m("span",null,"可放置此处增加满足动作",-1)),_l=[fl],bl={class:"right-half"},vl=K(()=>m("div",{class:"title"},"不满足动作",-1)),gl={class:"p8"},yl={style:{padding:"0 8px"}},hl=K(()=>m("span",null,"可放置此处增加不满足动作",-1)),kl=[hl],Cl=Object.assign({name:"EventConfigModal"},{__name:"ConfigModal",setup(n,{expose:a}){const o=D(!1),c=D(-1),l=D({}),{realFieldWedgits:p,formConfig:i}=L(),d=ae(()=>i.value.globalEvents.onEvents),g=D(!1);function y(w,S){c.value=S,l.value=w,o.value=!0}function b(){c.value===-1?d.value.push(l.value):d.value.splice(c.value,1,l.value),o.value=!1}const _=[{title:" ",slot:"handle",width:40,align:"center"},{title:"字段标识",slot:"fieldName",minWidth:100,tooltip:!0},{title:"匹配条件",slot:"compare",minWidth:100,tooltip:!0},{title:"匹配值",slot:"value",minWidth:100,tooltip:!0},{title:" ",slot:"action",width:40,align:"center"}],f=[{title:" ",slot:"handle",width:40,align:"center"},{title:"字段标识",slot:"fieldName",minWidth:100,tooltip:!0},{title:"执行动作",slot:"oType",minWidth:100,tooltip:!0},{title:" ",slot:"action",width:40,align:"center"}];a({open:y});function v(){g.value=!1}function $(w,S){w.dataTransfer.setData("Field",JSON.stringify(S)),console.log(S),g.value=!0}function j(w){w.preventDefault();let S=w.dataTransfer.getData("Field");const z=JSON.parse(S);if(l.value.fields.findIndex(Z=>Z.fieldName===z.model)>-1){ne.warning("已存在字段，无需重复设置");return}l.value.fields.push({fieldName:z.model,fieldTitle:z.label,compare:"",value:z.type==="input-number"?null:"",type:z.type})}function O(w){w.preventDefault();let S=w.dataTransfer.getData("Field");const z=JSON.parse(S);l.value.actions.push({fieldName:z.model,fieldTitle:z.label,oType:""})}function B(w){w.preventDefault();let S=w.dataTransfer.getData("Field");const z=JSON.parse(S);l.value.disActions.push({fieldName:z.model,fieldTitle:z.label,oType:""})}function F(w){l.value.fields=[...w]}function R(w){l.value.actions=[...w]}function ie(w){l.value.disActions=[...w]}function se(w){l.value.fields.splice(w,1)}function q(w){l.value.actions.splice(w,1)}function X(w){l.value.disActions.splice(w,1)}return(w,S)=>{var _e;const z=r("b-empty"),Z=r("b-tag"),de=r("b-option"),ce=r("b-select"),De=r("b-input-number"),Fe=r("b-input"),ue=r("b-table"),We=r("b-layout"),fe=r("b-button"),Te=r("b-modal");return s(),V(Te,{modelValue:o.value,"onUpdate:modelValue":S[4]||(S[4]=C=>o.value=C),title:`界面事件${c.value===-1?"新增":"编辑"}: ${((_e=l.value)==null?void 0:_e.name)||""}`,width:"1280px",top:"50px","body-styles":{padding:0},"mask-closable":!1},{footer:e(()=>[t(fe,{onClick:S[3]||(S[3]=C=>o.value=!1)},{default:e(()=>[h("取消")]),_:1}),t(fe,{type:"primary",onClick:b},{default:e(()=>[h("确定")]),_:1})]),default:e(()=>[t(We,{"has-sider":"",style:{height:"520px"}},{sider:e(()=>[Gt,u(p).length===0?(s(),V(z,{key:0},{default:e(()=>[h("面板暂无字段控件")]),_:1})):(s(),k("ul",el,[(s(!0),k(A,null,U(u(p),C=>(s(),k("li",{class:"form-edit-widget-label no-put",key:C.model,draggable:"true",onDragstart:x=>$(x,C),onDragend:v},[m("a",null,[m("span",ll,W(C.label),1)])],40,tl))),128))]))]),default:e(()=>[m("div",ol,[m("div",nl,[al,m("div",il,[t(ue,{columns:_,data:l.value.fields,"edit-table":"",draggable:"","max-height":"192",DragHandle:".handle",onDragDrop:F},{handle:e(()=>[t(oe)]),fieldName:e(({index:C})=>[m("div",sl,[t(Z,{title:l.value.fields[C].fieldName},{default:e(()=>[h(W(l.value.fields[C].fieldTitle),1)]),_:2},1032,["title"])])]),compare:e(({index:C})=>[t(ce,{modelValue:l.value.fields[C].compare,"onUpdate:modelValue":x=>l.value.fields[C].compare=x,clearable:""},{default:e(()=>[(s(!0),k(A,null,U(l.value.fields[C].type==="input-number"?u(Pe):u(qe),(x,E)=>(s(),V(de,{key:E,value:E,label:x},{default:e(()=>[h(W(x),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),value:e(({index:C})=>[l.value.fields[C].type==="input-number"?(s(),V(De,{key:0,modelValue:l.value.fields[C].value,"onUpdate:modelValue":x=>l.value.fields[C].value=x},null,8,["modelValue","onUpdate:modelValue"])):(s(),V(Fe,{key:1,modelValue:l.value.fields[C].value,"onUpdate:modelValue":x=>l.value.fields[C].value=x},null,8,["modelValue","onUpdate:modelValue"]))]),action:e(({index:C})=>[t(J,{type:"text",icon:"minus-circle",color:"danger","is-icon":"",tooltip:"删除",onClick:x=>se(C)},null,8,["onClick"])]),_:1},8,["data"])]),t(le,{name:"fade-in"},{default:e(()=>[g.value?(s(),k("div",{key:0,class:"top-mask",onDragover:S[0]||(S[0]=ee(()=>{},["prevent"])),onDrop:j},cl,32)):T("",!0)]),_:1})]),m("div",ul,[rl,m("div",ml,[t(ue,{columns:f,data:l.value.actions,"edit-table":"",draggable:"",DragHandle:".handle",onDragDrop:R,"max-height":"192"},{handle:e(()=>[t(oe)]),fieldName:e(({index:C})=>[m("div",pl,[t(Z,{title:l.value.actions[C].fieldName},{default:e(()=>[h(W(l.value.actions[C].fieldTitle),1)]),_:2},1032,["title"])])]),oType:e(({index:C})=>[t(ce,{modelValue:l.value.actions[C].oType,"onUpdate:modelValue":x=>l.value.actions[C].oType=x,clearable:""},{default:e(()=>[(s(!0),k(A,null,U(u(he),(x,E)=>(s(),V(de,{key:E,value:E,label:x},{default:e(()=>[h(W(x),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),action:e(({index:C})=>[t(J,{type:"text",icon:"minus-circle",color:"danger","is-icon":"",tooltip:"删除",onClick:x=>q(C)},null,8,["onClick"])]),_:1},8,["data"])]),t(le,{name:"fade-in"},{default:e(()=>[g.value?(s(),k("div",{key:0,class:"top-mask match",onDragover:S[1]||(S[1]=ee(()=>{},["prevent"])),onDrop:O},_l,32)):T("",!0)]),_:1})]),m("div",bl,[vl,m("div",gl,[t(ue,{columns:f,data:l.value.disActions,"edit-table":"",draggable:"",DragHandle:".handle",onDragDrop:ie,"max-height":"192"},{handle:e(()=>[t(oe)]),fieldName:e(({index:C})=>[m("div",yl,[t(Z,{title:l.value.disActions[C].fieldName},{default:e(()=>[h(W(l.value.disActions[C].fieldTitle),1)]),_:2},1032,["title"])])]),oType:e(({index:C})=>[t(ce,{modelValue:l.value.disActions[C].oType,"onUpdate:modelValue":x=>l.value.disActions[C].oType=x,clearable:""},{default:e(()=>[(s(!0),k(A,null,U(u(he),(x,E)=>(s(),V(de,{key:E,value:E,label:x},{default:e(()=>[h(W(x),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),action:e(({index:C})=>[t(J,{type:"text",icon:"minus-circle",color:"danger","is-icon":"",tooltip:"删除",onClick:x=>X(C)},null,8,["onClick"])]),_:1},8,["data"])]),t(le,{name:"fade-in"},{default:e(()=>[g.value?(s(),k("div",{key:0,class:"top-mask no-match",onDragover:S[2]||(S[2]=ee(()=>{},["prevent"])),onDrop:B},kl,32)):T("",!0)]),_:1})])])]),_:1})]),_:1},8,["modelValue","title"])}}}),Vl=P(Cl,[["__scopeId","data-v-6b901076"]]),wl={class:"events-cfg"},$l={class:"pt-10 pb-5"},xl=Object.assign({name:"EventsCfg"},{__name:"index",props:I({size:{type:String,default:"small"},labelWidth:{type:String,default:"85px"}},{modelValue:{type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=Y(n,"modelValue"),o=ae(()=>a.value.globalEvents),{paramsDesc:c,exampleDesc:l}=He(),p=[{title:" ",slot:"handle",width:40,align:"center"},{title:"界面事件名称",slot:"name",minWidth:100,tooltip:!0},{title:" ",slot:"action",width:60,align:"center"}];function i(_){o.value.onEvents=[..._]}function d(_){o.value.onEvents.splice(_,1)}function g(){var f;const _={name:"新事件名称"+o.value.onEvents.length,fields:[],actions:[],disActions:[]};(f=y.value)==null||f.open(_,-1)}const y=D(null);function b(_){var v;const f=Ye(o.value.onEvents[_]);(v=y.value)==null||v.open(f,_)}return(_,f)=>{const v=r("b-radio"),$=r("b-radio-group"),j=r("b-input"),O=r("b-table"),B=r("b-button");return s(),k("div",wl,[t(H,{label:"事件类型",labelWidth:n.labelWidth},{default:e(()=>[t($,{modelValue:o.value.type,"onUpdate:modelValue":f[0]||(f[0]=F=>o.value.type=F),type:"button",size:n.size},{default:e(()=>[t(v,{label:"simple"},{default:e(()=>[h("配置模式")]),_:1}),t(v,{label:"script"},{default:e(()=>[h("高级脚本")]),_:1})]),_:1},8,["modelValue","size"])]),_:1},8,["labelWidth"]),o.value.type==="simple"?(s(),k(A,{key:0},[t(O,{columns:p,data:o.value.onEvents,"edit-table":"",draggable:"",DragHandle:".handle",onDragDrop:i},{handle:e(()=>[t(oe)]),name:e(({index:F})=>[t(j,{modelValue:o.value.onEvents[F].name,"onUpdate:modelValue":R=>o.value.onEvents[F].name=R},null,8,["modelValue","onUpdate:modelValue"])]),action:e(({index:F})=>[t(J,{type:"text",icon:"edit","is-icon":"",tooltip:"编辑",onClick:R=>b(F)},null,8,["onClick"]),t(J,{type:"text",icon:"minus-circle",color:"danger","is-icon":"",tooltip:"删除",onClick:R=>d(F)},null,8,["onClick"])]),_:1},8,["data"]),m("div",$l,[t(B,{icon:"plus",dashed:"",size:"small",style:{width:"100%","border-radius":"8px"},onClick:g},{default:e(()=>[h(" 新增事件 ")]),_:1})])],64)):T("",!0),o.value.type==="script"?(s(),V(H,{key:1,label:"脚本函数",tooltip:"脚本函数作为高级用法，可以满足更多自定义设置",labelWidth:n.labelWidth},{default:e(()=>[t(Je,{modelValue:o.value.customScript.funcBody,"onUpdate:modelValue":f[1]||(f[1]=F=>o.value.customScript.funcBody=F),arguments:o.value.customScript.arguments,style:{display:"inline-flex",width:"auto"},paramsDesc:u(c),exampleDesc:u(l),label:"",funcExplain:"通过提供的参数编写脚本，可以实现更灵活的表单界面控制。"},null,8,["modelValue","arguments","paramsDesc","exampleDesc"])]),_:1},8,["labelWidth"])):T("",!0),t(Vl,{ref_key:"eventRef",ref:y},null,512)])}}}),Sl={class:"form-config-container"},Dl={class:"radio-group"},Fl={class:"config-content"},Wl={class:"comp-config-container"},Tl={key:0},Ol={key:1},jl=Object.assign({name:"FormConfig"},{__name:"FormConfig",props:I({size:{type:String,default:"small"},labelWidth:{type:String,default:"85px"}},{modelValue:{type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const a=Y(n,"modelValue"),o=D("base"),c=[{key:"dict1",name:"字典名1",options:[{key:"o1",label:"标签1"}]},{key:"dict2",name:"字典名2",options:[{key:"o1",label:"标签1"}]}],l=[{title:"基础",key:"base"},{title:"数据",key:"datasouce"},{title:"事件",key:"event"}];return(p,i)=>{const d=r("b-radio"),g=r("b-radio-group"),y=r("b-input-number"),b=r("b-input"),_=r("b-button"),f=r("b-scrollbar");return s(),k("div",Sl,[m("div",Dl,[t(g,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=v=>o.value=v),size:"default",type:"capsule"},{default:e(()=>[(s(),k(A,null,U(l,v=>t(d,{label:v.key,key:v.key},{default:e(()=>[h(W(v.title),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),m("div",Fl,[t(f,null,{default:e(()=>[m("div",Wl,[o.value==="base"?(s(),k("div",Tl,[t(H,{label:"标签对齐",labelWidth:n.labelWidth},{default:e(()=>[t(g,{modelValue:a.value.labelPosition,"onUpdate:modelValue":i[1]||(i[1]=v=>a.value.labelPosition=v),type:"button",size:n.size},{default:e(()=>[t(d,{label:"left"},{default:e(()=>[h("左侧")]),_:1}),t(d,{label:"top"},{default:e(()=>[h("顶部")]),_:1}),t(d,{label:"right"},{default:e(()=>[h("右侧")]),_:1})]),_:1},8,["modelValue","size"])]),_:1},8,["labelWidth"]),t(H,{label:"标签宽度",labelWidth:n.labelWidth},{default:e(()=>[t(y,{modelValue:a.value.labelWidth,"onUpdate:modelValue":i[2]||(i[2]=v=>a.value.labelWidth=v),min:60,max:300,step:5,size:n.size,disabled:a.value.labelPosition==="top"},null,8,["modelValue","size","disabled"])]),_:1},8,["labelWidth"]),t(H,{label:"标签后缀",labelWidth:n.labelWidth},{default:e(()=>[t(b,{modelValue:a.value.labelSuffix,"onUpdate:modelValue":i[3]||(i[3]=v=>a.value.labelSuffix=v),size:n.size,clearable:""},null,8,["modelValue","size"])]),_:1},8,["labelWidth"]),t(H,{label:"组件尺寸",labelWidth:n.labelWidth},{default:e(()=>[t(g,{modelValue:a.value.size,"onUpdate:modelValue":i[4]||(i[4]=v=>a.value.size=v),type:"button",size:n.size},{default:e(()=>[t(d,{label:"large"},{default:e(()=>[h("大号")]),_:1}),t(d,{label:"default"},{default:e(()=>[h("默认")]),_:1}),t(d,{label:"small"},{default:e(()=>[h("小号")]),_:1})]),_:1},8,["modelValue","size"])]),_:1},8,["labelWidth"])])):T("",!0),o.value==="datasouce"?(s(),k("div",Ol,[N(p.$slots,"DataSetCfg",{dataset:a.value.dataSet},()=>[t(H,{label:"数据配置",tooltip:"基于一定规则进行配置，这里通过一个固定插槽[DataSetCfg]予以动态抛出,作用域属性dataset用于外部设置。",labelWidth:n.labelWidth},{default:e(()=>[t(pe,{style:{display:"inline-block"},data:c,title:"格式查看"},{default:e(()=>[t(_,{type:"text"},{default:e(()=>[h("格式查看")]),_:1})]),_:1})]),_:1},8,["labelWidth"])],!0)])):T("",!0),o.value==="event"?(s(),V(xl,{key:2,modelValue:a.value,"onUpdate:modelValue":i[5]||(i[5]=v=>a.value=v)},null,8,["modelValue"])):T("",!0)])]),_:3})])])}}}),zl=P(jl,[["__scopeId","data-v-f5e14632"]]),Ul={class:"right-config-container"},Nl={class:"top-fix"},Bl=["onClick"],Rl={class:"config-content"},Al={key:0,style:{height:"100%"}},Ml={key:1,style:{height:"300px"},flex:"main:center cross:center"},Ll=Object.assign({name:"RightConfig"},{__name:"index",setup(n){const{selectWidget:a,currentCfgTab:o,widgetForm:c}=L(),l=[{key:"widget",title:"控件属性"},{key:"form",title:"表单属性"}];return(p,i)=>(s(),k("div",Ul,[m("div",Nl,[(s(),k(A,null,U(l,d=>m("div",{key:d.key,class:M(["tab-item",{active:d.key===u(o)}]),onClick:g=>o.value=d.key},W(d.title),11,Bl)),64))]),m("div",Rl,[u(o)==="widget"?(s(),k("div",Al,[u(a)?(s(),V(Zt,{key:0,modelValue:u(a),"onUpdate:modelValue":i[0]||(i[0]=d=>$e(a)?a.value=d:null)},null,8,["modelValue"])):(s(),k("div",Ml,"请添加组件"))])):(s(),V(zl,{key:1,modelValue:u(c).config,"onUpdate:modelValue":i[1]||(i[1]=d=>u(c).config=d)},{DataSetCfg:e(({dataset:d})=>[N(p.$slots,"DataSetCfg",{dataset:d})]),_:3},8,["modelValue"]))])]))}}),El=Object.assign({name:"BFormMaker"},{__name:"index",props:I({topTitle:{type:String,default:"FormMaker 表单设计器"},inner:Boolean,customFields:{type:Array,default:()=>[]},realFields:{type:Array,default:()=>[]}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:I(["onSave"],["update:modelValue"]),setup(n,{emit:a}){const o=a,c=n,l=Y(n,"modelValue"),{widgetForm:p,slotsWedigets:i,realFieldsDtos:d}=L();i.value=[...c.customFields],d.value=[...c.realFields];function g(){o("onSave",p.value)}return(y,b)=>(s(),V(it,{modelValue:l.value,"onUpdate:modelValue":b[0]||(b[0]=_=>l.value=_),topTitle:n.topTitle,inner:n.inner},{default:e(()=>[t(yt),t(Jt,{onOnSave:g},Q({_:2},[U(u(i),_=>({name:_.type,fn:e(({node:f})=>[N(y.$slots,_.type,{node:f})])}))]),1024),t(Ll,null,{DataSetCfg:e(({dataset:_})=>[N(y.$slots,"DataSetCfg",{dataset:_})]),_:3})]),_:3},8,["modelValue","topTitle","inner"]))}}),Il={class:"form-dict-wrap"},Pl={class:"pt-8"},ql={__name:"DatasetCfg",props:{modelValue:{type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(n){const a=Y(n,"modelValue"),o=[{title:"字典名称",key:"key",minWidth:100,tooltip:!0},{title:"字典编码",key:"name",minWidth:100,tooltip:!0},{title:" ",slot:"action",width:50,align:"center"}],c=ae(()=>a.value.dataSet);function l(i){c.value.splice(i,1)}function p(){c.value.push({key:"newKey_"+c.value.length,name:"模拟字典"+c.value.length,options:[{key:"o1",label:"标签1"},{key:"o2",label:"标签2"}]})}return(i,d)=>{const g=r("b-table"),y=r("b-button");return s(),k("div",Il,[t(g,{columns:o,data:c.value,size:"small","max-height":"440","edit-table":"","edit-table-detail":""},{action:e(({index:b})=>[t(J,{type:"text",icon:"minus-circle",color:"danger","is-icon":"",tooltip:"删除",onClick:_=>l(b)},null,8,["onClick"])]),_:1},8,["data"]),m("div",Pl,[t(y,{icon:"book",dashed:"",size:"small",style:{width:"100%","border-radius":"8px"},onClick:p},{default:e(()=>[h(" 表单字典配置 ")]),_:1})])])}}},Hl={style:{display:"inline-block"}},Jl={__name:"index",props:{customFields:{type:Array,default:()=>[]},realFields:{type:Array,default:()=>[]},jsonStr:{type:String,default:""},btnText:{type:String,default:"表单设计"},btnType:{type:String,default:"text"},btnDisabled:{type:Boolean},defaultOpen:{type:Boolean}},emits:["onSave"],setup(n,{expose:a,emit:o}){const c=o,l=n,{widgetForm:p,formConfig:i,initSchema:d}=Ke(),g=D(!1);function y(_){const f=Qe(_,{});d(f,l.realFields,l.customFields),g.value=!0}l.defaultOpen&&y(l.jsonStr);function b(){console.log("-----------------保存表单设计------------------"),console.log(p.value),c("onSave",p.value),g.value=!1}return a({openDesign:y}),(_,f)=>{const v=r("b-button");return s(),k("div",Hl,[N(_.$slots,"default",{},()=>[t(v,{type:n.btnType,disabled:n.btnDisabled,onClick:f[0]||(f[0]=$=>y(n.jsonStr))},{default:e(()=>[h(W(n.btnText),1)]),_:1},8,["type","disabled"])]),t(El,{modelValue:g.value,"onUpdate:modelValue":f[2]||(f[2]=$=>g.value=$),"top-title":"表单设计",customFields:n.customFields,realFields:n.realFields,ref:"makerRef",onOnSave:b},{"custom-comp":e(({node:$})=>[t(Se,Ne(Be($)),null,16)]),DataSetCfg:e(()=>[t(ql,{modelValue:u(i),"onUpdate:modelValue":f[1]||(f[1]=$=>$e(i)?i.value=$:null)},null,8,["modelValue"])]),_:1},8,["modelValue","customFields","realFields"])])}}},ke=[{type:"custom-comp",name:"自定义组件",icon:"appstoreadd"}],Ce=[{fieldName:"fname",fieldTitle:"员工姓名",fieldLength:10,fieldType:"string",required:!0},{fieldName:"fnumber",fieldTitle:"员工编号",fieldLength:10,fieldType:"string",required:!0},{fieldName:"fage",fieldTitle:"员工年龄",fieldLength:10,fieldType:"number",required:!1},{fieldName:"merit_pay",fieldTitle:"基本工资",fieldLength:10,fieldType:"number",required:!1},{fieldName:"year_month",fieldTitle:"薪资周期",fieldLength:0,fieldType:"string",required:!1},{fieldName:"birthday",fieldTitle:"出生日期",fieldLength:null,fieldType:"date",required:!1}];function Yl(){const n=D(null),a=D({}),{initSchema:o}=xe();function c(l){o({},Ce,ke),a.value={...l}}return{MakerDesign:Jl,jsonStr:null,realFields:Ce,customFields:ke,renderFormRef:n,defaultModel:a,init:c}}const Kl={class:"p24"},eo={__name:"home",setup(n){const{MakerDesign:a,jsonStr:o,realFields:c,customFields:l,renderFormRef:p}=Yl();function i(d){console.log(d)}return(d,g)=>(s(),k("div",Kl,[t(u(a),{"real-fields":u(c),"custom-fields":u(l),"json-str":u(o),"default-open":"",ref_key:"renderFormRef",ref:p,onOnSave:i},null,8,["real-fields","custom-fields","json-str"])]))}};export{eo as default};
